# seed.py
# -*- coding: utf-8 -*-
from sqlalchemy.orm import Session
from app.database import SessionLocal
from app import models

# ----------------- حوزه‌ها / مناطق -----------------
REGION_AREAS = [
    "منطقه یک", "منطقه دو", "منطقه سه", "منطقه چهار", "منطقه پنج",
    "منطقه شش", "منطقه هفت", "منطقه هشت", "منطقه نه", "منطقه ده",
    "منطقه یازده", "منطقه دوازده", "منطقه سیزده", "منطقه چهارده", "منطقه پانزده",
    "ناژوان",
]

# ----------------- معاونت‌ها / نهاد مرکزی -----------------
CENTRAL_AREAS = [
    "شهرداری مرکزی",
    "معاونت مالی اقتصادی",
    "معاونت برنامه ریزی و توسعه انسانی",
    "معاونت عمران شهری",
    "معاونت شهرسازی و معماری",
    "معاونت حمل و نقل و ترافیک",
    "معاونت خدمات شهری",
    "معاونت فرهنگی و اجتماعی",
    "شورای اسلامی شهر",
]

# ----------------- 27 اداره‌ی سراسری ویژه مناطق -----------------
GLOBAL_DEPARTMENTS = [
    "اداره برنامه ریزی و توسعه سرمایه انسانی",
    "اداره حمل و نفل و ترافیک",
    "اداره عمران",
    "اداره فرهنگی و اجتماعی",
    "امور ارتباطات",
    "امور املاک",
    "امور پیشگیری و رفع تخلف",
    "امور درآمد",
    "امور دفتری",
    "امور دفتری خدمات شهری",
    "امور زیباسازی",
    "امور سد معبر",
    "امور سرمایه گذاری و مشارکت ها",
    "امور شهر",
    "امور شهرسازی",
    "امور فضای سبز",
    "امور کارپردازی",
    "امور کنترل ساختمان",
    "امور گشت فنی ساختمان",
    "امور مالی",
    "امور محاسبات",
    "امور منابع انسانی",
    "امور نگهداری و تعمیرات",
    "رئیس اداره خدمات شهری",
    "رئیس اداره شهرسازی",
    "رئیس اداره مالی و اقتصادی",
    "مدیر منطقه",
]

# ----------------- قسمت‌های هر اداره -----------------
DEPT_SECTIONS = {
    "اداره برنامه ریزی و توسعه سرمایه انسانی": [
        "آمار و اطلاعات",
        "احکام و ارتقا شغلی",
        "ارزیابی عملکرد",
        "استخدام",
        "ایثارگران",
        "تشکیلات",
        "تکریم ارباب رجوع",
        "حضور و غیاب و مرخصی",
        "حقوق و دستمزد",
        "رفاهی",
        "سرمایه انسانی",
        "مدیریت دانش",
        "مدیریت فرآیند‌ها و ممیزی داخلی",
        "نیازسنجی، ارزیابی و اثربخشی",
        "ورزش کارکنان",
    ],
    "اداره حمل و نفل و ترافیک": [
        "پارکینگ حاشیه‌ای و طبقاتی",
        "ترافیک",
        "کنترل کیفیت هوا",
        "معاینه فنی خودرو",
        "هماهنگی مناطق",
    ],
    "اداره عمران": [
        "نظارت عمران",
        "نظارت و تاسیسات برق",
        "نظارت و تاسیسات مکانیکی",
        "نظام فنی اجرایی",
        "نظارت راه و آسفالت",
    ],
    "اداره فرهنگی و اجتماعی": [
        # عمداً خالی
    ],
    "امور ارتباطات": [
        "ارتباطات",
        "تبلیغات و مراسم",
        "تشریفات",
        "ملاقاتهای مردمی",
    ],
    "امور املاک": [
        "هماهنگی و برنامه‌ریزی آزادسازی",
        "ثبت اسناد و املاک",
        "آمار و بانک اطلاعات املاک و مستغلات",
        "فروش و تهاتر ملکی",
    ],
    "امور پیشگیری و رفع تخلف": [
        "پیشگیری و رسیدگی تخلفات",
        "اجرائیات و اجرای آرای کمیسیون‌ها",
        "کنترل ساختمان و گشت فنی",
        "سد معبر و رفع موانع معبر",
    ],
    "امور درآمد": [
        "ممیزی و تشخیص درآمد",
        "عوارض خودرو",
        "عوارض کسب و پیشه",
        "عوارض نوسازی",
        "وصول درآمد",
        "محاسبات درآمد و عوارض",
        "تلفیق حساب‌ها و گزارشگری مالی",
        "حسابداری  منابع مالی و سازمان‌های دولتی",
        "سهام و تامین منابع",
    ],
    "امور دفتری": [
        "دبیرخانه و بایگانی",
        "مکاتبات و پیگیری اداری",
        "ثبت و گردش نامه‌ها در سامانه‌های اداری",
    ],
    "امور دفتری خدمات شهری": [
        "دبیرخانه و بایگانی خدمات شهری",
        "مخابرات و پاسخگویی تلفنی خدمات شهری",
        "سامانه‌ها و شهر هوشمند خدمات شهری",
    ],
    "امور زیباسازی": [
        "مبلمان و المان‌های شهری",
        "تابلوها و و تبلیغات محیطی",
        "نورپردازی و سیما و منظر شب",
        "رنگ و نقاشی شهری",
    ],
    "امور سد معبر": [
        "گشت سد معبر",
        "رسیدگی و اجرای آرای مرتبط با سد معبر",
        "ساماندهی دست‌فروشان و مشاغل سیار",
    ],
    "امور سرمایه گذاری و مشارکت ها": [
        "مطالعات و شناسایی فرصت‌های سرمایه‌گذاری",
        "جذب سرمایه‌گذار و مذاکره مشارکت‌ها",
        "ارزیابی و مدل‌سازی مالی پروژه‌ها",
        "نظارت بر اجرای قراردادهای مشارکت",
    ],
    "امور شهر": [
        "شهر هوشمند و خدمات الکترونیک",
        "سامانه‌های ارتباط مردمی و پیگیری درخواست‌ها",
        "فناوری اطلاعات و ارتباطات منطقه",
    ],
    "امور شهرسازی": [
        "ایستایی",
        "شهرسازی و معماری",
        "مهندسین",
        "نقشه‌برداری",
        "هماهنگی و نظارت بر دفاتر پیشخوان",
    ],
    "امور فضای سبز": [
        "طراحی و توسعه فضای سبز",
        "گهداشت و آبیاری فضای سبز و انهار",
        "نظارت بر پیمانکاران فضای سبز",
    ],
    "امور کارپردازی": [
        "خرید و تدارکات",
        "انبار و تحویل کالا",
        "مناقصه و مزایده و قراردادهای خرید",
    ],
    "امور کنترل ساختمان": [
        "کنترل نقشه و پروانه و ضوابط شهرسازی",
        "بازدید میدانی و کنترل اجرای ساختمان",
        "پیگیری تخلفات ساختمانی و ارتباط با کمیسیون‌های ماده صد",
    ],
    "امور گشت فنی ساختمان": [
        "برنامه‌ریزی گشت‌های فنی",
        "بازرسی فنی میدانی ساختمان‌ها",
        "ثبت و گزارش تخلفات ساختمانی",
    ],
    "امور مالی": [
        "حسابداری عمومی و دفاتر",
        "ذیحسابی و خزانه / دریافت و پرداخت",
        "حسابرسی داخلی و ممیزی اسناد",
        "پشتیبانی مالی پروژه‌های ساختمانی",
    ],
    "امور محاسبات": [
        "محاسبات درآمد و عوارض",
        "محاسبات هزینه و بودجه",
        "تلفیق حساب‌ها و گزارشگری مالی",
    ],
    "امور منابع انسانی": [
        "احکام و ارتقا شغلی",
        "استخدام و به‌کارگیری",
        "ارزیابی عملکرد",
        "تشکیلات و چارت سازمانی",
        "حضور و غیاب و مرخصی",
        "حقوق و دستمزد",
        "رفاه و امور کارکنان",
        "سرمایه انسانی و توسعه منابع",
    ],
    "امور نگهداری و تعمیرات": [
        "نگهداری پیشگیرانه تجهیزات و تأسیسات",
        "تعمیرات اصلاحی و اضطراری",
        "بهینه‌سازی مصرف انرژی و بهبود بهره‌وری",
    ],
    "رئیس اداره خدمات شهری": [
        "خدمات شهری و نظارت بر مناطق",
        "فضای سبز و انهار",
        "تأسیسات مکانیکی و تأسیسات شهری",
        "برنامه‌ریزی بحران و مدیریت حوادث",
    ],
    "رئیس اداره شهرسازی": [
        "طرح‌های جامع، تفصیلی و منطقه‌ای",
        "ضوابط و کنترل شهرسازی",
        "نقشه‌برداری و اطلاعات مکانی",
        "دفاتر پیشخوان شهرسازی و خدمات الکترونیک",
    ],
    "رئیس اداره مالی و اقتصادی": [
        "درآمد و عوارض",
        "امور مالی و ذیحسابی / حسابداری",
        "حسابرسی و ممیزی اسناد",
        "تأمین منابع و امور سهام",
    ],
    "مدیر منطقه": [
        "دفتر مدیر منطقه و دبیرخانه",
        "برنامه‌ریزی و کنترل عملکرد منطقه",
        "نظارت میدانی و ارتباط با شهروندان و شورای شهر",
    ],
}

# ----------------- قسمت‌های معاونت‌ها -----------------
CENTRAL_AREA_SECTIONS = {
    "شهرداری مرکزی": [
        "اداره کل حوزه شهردار",
        "اداره کل ارتباطات و امور بين الملل",
        "مديريت امور هماهنگي مناطق",
        "امور تبليغات و مراسمات",
        "امور تشريفات",
        "اداره کل امورحقوقي",
        "اداره کل حراست",
        "اداره کل بازرسي",
        "مديريت خلاقيت و فناوري نوين",
        "اداره کل حسابرسي داخلي و امور مجامع",
        "اداره امور بين الملل",
        "اداره ارتباطات رسانه اي",
        "اداره توليدات رسانه اي-صدا و سيماي شهر",
        "تعامل با شهرهاي خواهر خوانده",
        "اداره قراردادها",
        "مشاوران شهردار",
        "اداره هماهنگي ارتباطات",
        "اداره توليدات رسانه اي-ايمنا",
        "اداره توليدات رسانه اي-اصفهان زيبا",
        "اداره ارتباطات مردمي",
        "دفتر فني و طراحي-سازمان طراحي شهري",
        "مهمانسراي تهران",
        "غيرقابل تخصيص حوزه شهردار",
        "مشترک حوزه شهردار",
    ],
    "معاونت مالی اقتصادی": [
        "حوزه معاونت مالي و اقتصادي",
        "اداره کل امور مالي",
        "مديريت تدارکات و پشتيباني",
        "اداره کل درآمد",
        "اداره کل املاک",
        "اداره انبار و اموال",
        "اداره حسابداري",
        "اصفهان کارت",
        "خزانه داري",
        "اداره وصول درآمد",
        "اداره امور ثبتي و حقوقي املاک",
        "اداره آزاد سازي و ارزيابي املاک",
        "اداره انبار و اموال",
        "امور پشتيباني ترابري",
        "اداره تدارکات و کارپردازي",
        "امور مخابرات",
        "اداره تأمين املاک معوض",
        "امور نگهداري و تعميرات",
        "غيرقابل تخصيص معاونت مالي و اقتصادي",
        "مشترک معاونت مالي و اقتصادي",
    ],
    "معاونت برنامه ریزی و توسعه انسانی": [
        "حوزه معاونت برنامه ريزي و توسعه سرمايه انساني",
        "اداره کل برنامه ريزي و بودجه",
        "اداره کل نوسازي و تحول",
        "اداره دبيرخانه و بايگاني",
        "اداره برنامه ريزي ومهندسي شغل سرمايه هاي انساني",
        "امور تکريم ارباب و رجوع",
        "اداره نگهداشت و انفصال سرمايه هاي انساني",
        "اداره بهداشت و سلامت کارکنان -درمانگاه",
        "اداره بهداشت و سلامت کارکنان-امور بيمه",
        "اداره رفاه",
        "شرکت تعاوني کارگران",
        "شرکت تعاوني کارمندان",
        "تعاوني مسکن",
        "باشگاه شماره يک",
        "باشگاه شماره دو",
        "باشگاه شماره سه",
        "ويلاي شمال چابکسر",
        "ويلاي شمال عباس آباد",
        "مهمانسراي مشهد",
        "ويلاي باغ بهادران",
        "ويلاي چادگان",
        "کانون بازنشستگان-تامين اجتماعي",
        "کانون بازنشستگان-خدمات درماني",
        "کانون فرهنگي،آموزشي فرزندان پرسنل",
        "اداره کل سرمايه انساني",
        "امور شهر هوشمند و خدمات الکترونيک",
        "رصدخانه شهري",
        "مسابقات ورزشي كاركنان",
        "اداره آموزش",
        "رفاهيات کارکنان",
        "گروه پژوهش",
        "پشتيباني نرم افزارها",
        "پشتيباني سخت افزارها",
        "پشتيباني شبکه",
        "پشتيباني مرکز داده",
        "غير قابل تخصيص معاونت برنامه ريزي وتوسعه",
        "مشترک معاونت برنامه ريزي و توسعه",
    ],
    "معاونت عمران شهری": [
        "اداره کل امورفني ونظارت برپروژه هاعمراني",
        "اداره کل هماهنگي وبرنامه ريزي امورعمراني",
        "مديريت نگهداري و تعميرات ابنيه فني شهري",
        "حوزه معاونت فني و عمراني",
        "اداره رسيدگي مجدد",
        "آزمايشگاه مکانيک خاک",
        "مديريت پروژه رينگ حفاظتي شهر",
        "مرکز همايشهاي بين المللي امام خامنه اي",
        "غيرقابل تخصيص معاونت فني و عمراني",
        "مشترک معاونت فني و عمراني",
    ],
    "معاونت شهرسازی و معماری": [
        "حوزه معاونت شهرسازي و معماري",
        "اداره کل طرح هاي توسعه شهري",
        "اداره کل نظارت بر اجراي ضوابط شهرسازي",
        "امور اجرايي کميسيون هاي ماده صد",
        "غيرقابل تخصيص معاونت شهرسازي و معماري",
        "مشترک معاونت شهرسازي و معماري",
    ],
    "معاونت حمل و نقل و ترافیک": [
        "حوزه معاونت حمل و نقل و ترافيک",
        "مرکز کنترل ترافيک و نظارت تصويري",
        "اداره کل مطالعات و برنامه ريزي حمل و نقل",
        "امور کنترل کيفيت هوا",
        "اداره کل امور اجرايي ترافيک",
        "امور آموزش و فرهنگ ترافيک",
        "غيرقابل تخصيص معاونت حمل و نقل و ترافيک",
        "مشترک معاونت حمل و نقل و ترافيک",
    ],
    "معاونت خدمات شهری": [
        "حوزه معاونت خدمات شهري",
        "اداره کل هماهنگي و نظارت بر خدمات شهري",
        "مديريت بهينه سازي و نگهداري تاسيسات شهري",
        "اداره پيشگيري و رفع تخلفات شهري",
        "گروه بحران",
        "بهينه سازي (نت)",
        "سايت سجزي",
        "مديريت پارک طبيعي شرق",
        "غيرقابل تخصيص حوزه معاونت خدمات شهري",
        "مشترک حوزه معاونت خدمات شهري",
    ],
    "معاونت فرهنگی و اجتماعی": [
        "حوزه معاونت فرهنگي ،اجتماعي ورزشي",
        "اداره توسعه فرهنگ شهروندي",
        "معاونت فرهنگي هنري",
        "معاونت امور اجتماعي و شهروندي",
        "معاونت ورزشي و تفريحي",
        "اداره توسعه فرهنگ سلامت",
        "جشنواره فيلم کودک",
        "جشنواره‌هاي شهرداري",
        "بزرگداشت روز اصفهان",
        "نمايشگاه يار مهربان",
        "سرزنده سازي محور چهارباغ",
        "برنامه هاي ويژه اعياد",
        "برنامه ها و رويدادهاي گردشگري پايدار",
        "ستاد اقامه نماز",
        "غيرقابل تخصيص معاونت فرهنگي،اجتماعي ورزش",
        "مشترک معاونت فرهنگي،اجتماعي ورزشي",
    ],
    "شورای اسلامی شهر": [
        "امور شوراي اسلامي شهر",
        "اداره هماهنگي امور شوراي اسلامي شهر",
        "غيرقابل تخصيص امور شوراي اسلامي شهر",
        "مشترک امور شوراي اسلامي شهر",
    ],
}


def build_orgunit_records() -> list[dict]:
    records: list[dict] = []
    all_areas = REGION_AREAS + CENTRAL_AREAS
    area_index = {name: f"{i+1:02d}" for i, name in enumerate(all_areas)}
    dept_index = {name: f"{i+1:02d}" for i, name in enumerate(GLOBAL_DEPARTMENTS)}
    domain_code = "01"

    # مناطق: هر اداره → لیست قسمت‌ها
    for area in REGION_AREAS:
        for dept in GLOBAL_DEPARTMENTS:
            sections = DEPT_SECTIONS.get(dept, [])
            for j, section in enumerate(sections, start=1):
                records.append(
                    dict(
                        area_code=area,
                        domain_code=domain_code,
                        dept_code=dept_index[dept],
                        section_code=f"{j:02d}",
                        full_code=f"{area_index[area]}-{domain_code}-{dept_index[dept]}-{j:02d}",
                        title=f"{section} / {dept} / {area}",
                    )
                )

    # معاونت‌ها: قسمت‌ها مستقیم زیر خود معاونت
    for area in CENTRAL_AREAS:
        sections = CENTRAL_AREA_SECTIONS.get(area, [])
        for j, section in enumerate(sections, start=1):
            records.append(
                dict(
                    area_code=area,
                    domain_code=domain_code,
                    dept_code="01",
                    section_code=f"{j:02d}",
                    full_code=f"{area_index[area]}-{domain_code}-01-{j:02d}",
                    title=f"{section} / {area} / {area}",
                )
            )

    return records


def main():
    db: Session = SessionLocal()
    try:
        # پاک‌سازی
        db.query(models.SpecialAction).delete()
        db.query(models.ContinuousAction).delete()
        db.query(models.ActionType).delete()
        db.query(models.OrgUnit).delete()
        db.commit()

        # OrgUnit
        org_records = build_orgunit_records()
        for rec in org_records:
            db.add(models.OrgUnit(**rec))
        db.commit()
        print(f"Inserted org_units: {len(org_records)}")

        # چند اقدام مستمر نمونه
        sample = (
            db.query(models.OrgUnit)
            .order_by(models.OrgUnit.id)
            .limit(2)
            .all()
        )
        if sample:
            db.add_all(
                [
                    models.ContinuousAction(
                        org_unit_id=sample[0].id,
                        code="CA001",
                        title="نگهداری دوره‌ای مساجد",
                    ),
                    models.ContinuousAction(
                        org_unit_id=sample[1].id,
                        code="CA002",
                        title="پروژه‌های عمرانی معابر",
                    ),
                ]
            )
            # چند نوع اقدام ویژه
            db.add_all(
                [
                    models.ActionType(code="ACT017", title="تعمیر مسجد"),
                    models.ActionType(code="ACT021", title="آسفالت‌کاری"),
                    models.ActionType(code="ACT030", title="رنگ‌آمیزی معابر"),
                ]
            )
            db.commit()
            print("Seed completed.")
        else:
            print("No OrgUnits generated!")

    finally:
        db.close()


if __name__ == "__main__":
    main()
